<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Orders - The Sky Online</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .order-card {
            border-left: 5px solid #0d6efd;
        }
        .logo-img {
            height: 40px;
        }
        .upload-form {
            display: none;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
    <div class="container d-flex justify-content-between">
        <a class="navbar-brand" href="/">
            <img src="/images/kyline-logo.jpeg" class="logo-img" alt="Logo"> The Sky
        </a>
        <div>
            <a class="btn btn-outline-light me-2" href="/">Home <i class="bi bi-house-door"></i></a>
            <a th:if="${session.loggedInCustomer != null}" class="btn btn-outline-light" href="/orders/logout">Logout <i class="bi bi-box-arrow-right"></i></a>
        </div>
    </div>
</nav>

<!-- Header -->
<section class="py-5 text-center">
    <div class="container">
        <img src="/images/kyline-logo.jpeg" alt="Sky Logo" style="height: 80px;" class="mb-3">
        <h1 class="h3">My Orders</h1>
        <p class="lead">Below are the services youâ€™ve ordered</p>
    </div>
</section>

<!-- Orders Section -->
<section class="container mb-5">
    <div th:if="${orders.isEmpty()}">
        <p class="text-center text-muted">You have no orders yet. <i class="bi bi-file-earmark-x"></i></p>
    </div>

    <div th:each="order : ${orders}" class="card order-card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title">
                <i class="bi bi-clipboard-check"></i>
                <span th:text="${order.service.title}">Service Title</span>
            </h5>

            <p class="mb-1">
                <strong>Status:</strong>
                <span th:text="${order.status}">Pending</span>
            </p>
            <p class="mb-1">
                <strong>Date Placed:</strong>
                <span th:text="${#temporals.format(order.datePlaced, 'dd MMM yyyy HH:mm')}">15 Apr 2025</span>
            </p>
            <p class="mb-1" th:if="${order.service.cost != null}">
                <strong>Cost:</strong> TSH
                <span th:text="${#numbers.formatDecimal(order.service.cost, 0, 'COMMA', 0, 'POINT')}">0</span>
            </p>

            <!-- Cancel Button for Pending Orders -->
            <form th:if="${order.status == 'Pending'}"
                  th:action="@{'/orders/cancel/' + ${order.id}}"
                  method="post"
                  class="d-inline">
                <button type="submit" class="btn btn-sm btn-danger mt-2">
                    <i class="bi bi-x-circle"></i> Cancel Order
                </button>
            </form>
<!--            &lt;!&ndash; Link to Upload Documents Form &ndash;&gt;-->
<!--            <a href="#" class="btn btn-sm btn-warning mt-2" onclick="toggleUploadForm(event, 'upload-form-[[${order.id}]]')">-->
<!--                <i class="bi bi-upload"></i> Upload Documents or Information-->
<!--            </a>-->

            <!-- Download Button -->
            <a th:href="@{'/orders/download/' + ${order.id}}"
               class="btn btn-sm btn-outline-primary mt-2"
               th:classappend="${order.status == 'Cancelled'} ? ' disabled' : ''">
                <i class="bi bi-download"></i> Download Receipt (PDF)
            </a>

            <!-- Upload Form (Initially hidden) -->
<!--            <div id="upload-form-[[${order.id}]]" class="upload-form">-->
<!--                <form th:action="@{'/orders/upload/' + ${order.id}}" method="post" enctype="multipart/form-data" onsubmit="return validateForm([[${order.id}]])">-->
<!--                    <div class="mb-3">-->
<!--                        <label for="document-[[${order.id}]]" class="form-label">Select Document (Optional)</label>-->
<!--                        <input type="file" class="form-control" name="document" id="document-[[${order.id}]]">-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <textarea class="form-control" name="description" id="description-[[${order.id}]]" rows="3" placeholder="Add any information as required eg. NIDA number..." ></textarea>-->
<!--                    </div>-->
<!--                    <button type="submit" class="btn btn-success"><i class="bi bi-upload"></i> Submit</button>-->
<!--                </form>-->
<!--            </div>-->
        </div>
    </div>

    <div class="card p-3 mb-4 text-end" th:if="${totalCost > 0}">
        <h5>Total Cost: TSH
            <span th:text="${#numbers.formatDecimal(totalCost, 0, 'COMMA', 0, 'POINT')}">0</span>
        </h5>
    </div>

    <div class="text-center">
        <a href="/services" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Add More Services
        </a>
    </div>
</section>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-3">
    <div>&copy; 2025 The Sky Online Service</div>
    <div>Developed by <a href="mailto:meshackvenance99@gmail.com" class="text-info text-decoration-none">Mr. Meshack Venance</a></div>
</footer>

<script>
    // Hide the alert after 4 seconds
    setTimeout(() => {
        const alert = document.querySelector('.alert');
        if (alert) {
            alert.style.display = 'none';
        }
    }, 4000);

    // Function to toggle the display of the upload form
    function toggleUploadForm(event, formId) {
        event.preventDefault();
        const form = document.getElementById(formId);
        form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'block' : 'none';
    }

    // Validate the form to ensure at least one field is filled
    function validateForm(orderId) {
        const documentField = document.getElementById('document-' + orderId);
        const descriptionField = document.getElementById('description-' + orderId);

        if (!documentField.files.length && !descriptionField.value.trim()) {
            alert('Please upload a document or provide written information.');
            return false;
        }
        return true;
    }
</script>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- Bootstrap icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</body>
</html>
